<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="漏洞成因漏洞的形成是因为New-DlpPolicy命令对TempleteData参数的过滤不严，从而导致了RCE。我们可以通过访问https:&#x2F;&#x2F;example.com&#x2F;ecp&#x2F;DLPPolicy&#x2F;ManagePolicyFromISV.aspx?pwmcid&#x3D;20&amp;ReturnObjectType&#x3D;1页面来上传payload。 漏洞分析在知道漏洞的原因后，我们找到对应的aspx文件 12">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2020-16875 Exchange Server RCE">
<meta property="og:url" content="http://yoursite.com/2020/11/19/CVE-2020-16875/index.html">
<meta property="og:site_name" content="学习记录">
<meta property="og:description" content="漏洞成因漏洞的形成是因为New-DlpPolicy命令对TempleteData参数的过滤不严，从而导致了RCE。我们可以通过访问https:&#x2F;&#x2F;example.com&#x2F;ecp&#x2F;DLPPolicy&#x2F;ManagePolicyFromISV.aspx?pwmcid&#x3D;20&amp;ReturnObjectType&#x3D;1页面来上传payload。 漏洞分析在知道漏洞的原因后，我们找到对应的aspx文件 12">
<meta property="og:locale">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/1.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/2.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/3.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/4.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/5.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/6.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/15.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/7.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/9.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/11.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/12.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/13.png">
<meta property="og:image" content="http://yoursite.com/img/cve-2020-16875/14.png">
<meta property="article:published_time" content="2020-11-19T14:54:35.000Z">
<meta property="article:modified_time" content="2020-11-22T02:38:12.993Z">
<meta property="article:author" content="lex">
<meta property="article:tag" content="CVE">
<meta property="article:tag" content="RCE">
<meta property="article:tag" content="Exchange Server">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/img/cve-2020-16875/1.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>CVE-2020-16875 Exchange Server RCE</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/POC/">POC</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/11/22/Exchange-New-Export-Certificate-RCE/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/10/18/CVE-2019-0230-S2-059/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/11/19/CVE-2020-16875/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&text=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&title=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&is_video=false&description=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2020-16875 Exchange Server RCE&body=Check out this article: http://yoursite.com/2020/11/19/CVE-2020-16875/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&title=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&title=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&title=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&title=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&name=CVE-2020-16875 Exchange Server RCE&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2020/11/19/CVE-2020-16875/&t=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%88%90%E5%9B%A0"><span class="toc-number">1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A1%A5%E4%B8%81"><span class="toc-number">3.</span> <span class="toc-text">更新补丁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="toc-number">4.</span> <span class="toc-text">参考文档</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        CVE-2020-16875 Exchange Server RCE
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">学习记录</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-11-19T14:54:35.000Z" itemprop="datePublished">2020-11-19</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/CVE/" rel="tag">CVE</a>, <a class="tag-link-link" href="/tags/Exchange-Server/" rel="tag">Exchange Server</a>, <a class="tag-link-link" href="/tags/RCE/" rel="tag">RCE</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>漏洞的形成是因为<code>New-DlpPolicy</code>命令对<code>TempleteData</code>参数的过滤不严，从而导致了<code>RCE</code>。我们可以通过访问<code>https://example.com/ecp/DLPPolicy/ManagePolicyFromISV.aspx?pwmcid=20&amp;ReturnObjectType=1</code>页面来上传<code>payload</code>。</p>
<h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>在知道漏洞的原因后，我们找到对应的<code>aspx</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language&#x3D;&quot;C#&quot;  </span><br><span class="line">    Inherits&#x3D;&quot;Microsoft.Exchange.Management.ControlPanel.ManagePolicyFromISV&quot;</span><br><span class="line">    MasterPageFile&#x3D;&quot;~&#x2F;CommonMaster.Master&quot;</span><br><span class="line">    Title&#x3D;&quot;&lt;%$Strings:DLPImportTitle%&gt;&quot;</span><br><span class="line">    Caption&#x3D;&quot;&lt;%$Strings:DLPImportCaption%&gt;&quot;</span><br><span class="line">    FVAResource&#x3D;&quot;ManagePolicyFromISVFVA&quot;</span><br><span class="line">    HelpId&#x3D;&quot;ManagePolicyFromISV&quot;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<p>该页面由<code>Microsoft.Exchange.Management.ControlPanel.ManagePolicyFromISV</code>类进行处理，在这个类的<code>ExecuteUpload</code>函数下断点进行跟踪</p>
<p><img src="/img/cve-2020-16875/1.png" alt="1"></p>
<p>接着上传payload，我们跟进函数，并且一步一步向下走</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PowerShellResults powerShellResults &#x3D; dlpisvservice.ProcessUpload(new DLPNewPolicyUploadParameters</span><br><span class="line">                    &#123;</span><br><span class="line">                        Mode &#x3D; this.policyMode.SelectedValue,</span><br><span class="line">                        State &#x3D; RuleState.Enabled.ToString(),</span><br><span class="line">                        Name &#x3D; this.name.Text,</span><br><span class="line">                        Description &#x3D; this.description.Text,</span><br><span class="line">                        TemplateData &#x3D; array</span><br><span class="line">                    &#125;);</span><br></pre></td></tr></table></figure>
<p>接着到达<code>&#123;Microsoft.Exchange.MessagingPolicies.CompliancePrograms.Tasks.NewDlpPolicyImpl&#125;.LoadDlpPolicyFromCustomTemplateData()</code>来处理传入的<code>TemplateData</code><br><img src="/img/cve-2020-16875/2.png" alt="2"></p>
<p>在这里调用<code>DlpUtils.LoadDlpPolicyTemplates</code>函数来加载数据，跟进</p>
<p><img src="/img/cve-2020-16875/3.png" alt="3"></p>
<p>传入的数据交给了返回类型为<code>IEnumerable&lt;DlpPolicyTemplateMetaData&gt;</code>的<code>Microsoft.Exchange.MessagingPolicies.CompliancePrograms.Tasks.DlpPolicyParser.ParserDlpPolicyTemplates</code>函数做解析处理，查看该函数的定义，部分代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">internal static IEnumerable&lt;DlpPolicyTemplateMetaData&gt; ParseDlpPolicyTemplates(Stream data)</span><br><span class="line">&#123;</span><br><span class="line">    List&lt;DlpPolicyTemplateMetaData&gt; result;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">        XDocument xdocument &#x3D; XDocument.Load(data);</span><br><span class="line">        if (EtrSettingsConfiguration.GetSnapshot(MachineSettingsContext.Local, null, null).DlpPolicyTemplateSchemaValidation.Enabled)</span><br><span class="line">        &#123;</span><br><span class="line">            xdocument.Validate(DlpPolicyParser.Schema.Value, null);</span><br><span class="line">        &#125;</span><br><span class="line">        result &#x3D; (from dlpPolicyTemplate in xdocument.Element(&quot;dlpPolicyTemplates&quot;).Elements(&quot;dlpPolicyTemplate&quot;)</span><br><span class="line">        select DlpPolicyParser.ParseDlpPolicyTemplate(dlpPolicyTemplate.ToString())).ToList&lt;DlpPolicyTemplateMetaData&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该函数解析了<code>xml</code>，判断是否为合法的<code>xml</code>数据，获取<code>dlpPolicyTemplate</code>标签之间的数据，接着再由重写返回类型为<code>DlpPolicyTemplateMetaData</code>的<code>Microsoft.Exchange.MessagingPolicies.CompliancePrograms.Tasks.DlpPolicyParser.ParseDlpPolicyTemplates</code>对每条数据进行处理并且验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">internal static DlpPolicyTemplateMetaData ParseDlpPolicyTemplate(string data)</span><br><span class="line">&#123;</span><br><span class="line">    DlpPolicyTemplateMetaData result;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">        XElement root &#x3D; XDocument.Parse(data).Root;</span><br><span class="line">        DlpPolicyTemplateMetaData dlpPolicyTemplateMetaData &#x3D; new DlpPolicyTemplateMetaData();</span><br><span class="line">        dlpPolicyTemplateMetaData.Version &#x3D; root.Attribute(&quot;version&quot;).Value.Trim();</span><br><span class="line">        dlpPolicyTemplateMetaData.State &#x3D; (RuleState)Enum.Parse(typeof(RuleState), root.Attribute(&quot;state&quot;).Value.Trim());</span><br><span class="line">        dlpPolicyTemplateMetaData.Mode &#x3D; (RuleMode)Enum.Parse(typeof(RuleMode), root.Attribute(&quot;mode&quot;).Value.Trim());</span><br><span class="line">        dlpPolicyTemplateMetaData.ImmutableId &#x3D; ((root.Attribute(&quot;id&quot;) &#x3D;&#x3D; null) ? Guid.Empty : Guid.Parse(root.Attribute(&quot;id&quot;).Value.Trim()));</span><br><span class="line">        dlpPolicyTemplateMetaData.ContentVersion &#x3D; root.Element(&quot;contentVersion&quot;).Value.Trim();</span><br><span class="line">        dlpPolicyTemplateMetaData.PublisherName &#x3D; root.Element(&quot;publisherName&quot;).Value.Trim();</span><br><span class="line">        dlpPolicyTemplateMetaData.LocalizedNames &#x3D; DlpPolicyParser.ParseLocalizedString(root.Element(&quot;name&quot;));</span><br><span class="line">        dlpPolicyTemplateMetaData.LocalizedDescriptions &#x3D; DlpPolicyParser.ParseLocalizedString(root.Element(&quot;description&quot;));</span><br><span class="line">        dlpPolicyTemplateMetaData.LocalizedKeywords &#x3D; (from localizedKeyword in root.Element(&quot;keywords&quot;).Elements(&quot;keyword&quot;)</span><br><span class="line">        select DlpPolicyParser.ParseLocalizedString(localizedKeyword)).ToList&lt;Dictionary&lt;string, string&gt;&gt;();</span><br><span class="line">        dlpPolicyTemplateMetaData.RuleParameters &#x3D; (from ruleParameter in root.Element(&quot;ruleParameters&quot;).Elements(&quot;ruleParameter&quot;)</span><br><span class="line">        select new DlpTemplateRuleParameter</span><br><span class="line">        &#123;</span><br><span class="line">            Type &#x3D; ruleParameter.Attribute(&quot;type&quot;).Value.Trim(),</span><br><span class="line">            Required &#x3D; bool.Parse(ruleParameter.Attribute(&quot;required&quot;).Value),</span><br><span class="line">            Token &#x3D; ruleParameter.Attribute(&quot;token&quot;).Value.Trim(),</span><br><span class="line">            LocalizedDescriptions &#x3D; DlpPolicyParser.ParseLocalizedString(ruleParameter.Element(&quot;description&quot;))</span><br><span class="line">        &#125;).ToList&lt;DlpTemplateRuleParameter&gt;();</span><br><span class="line">        dlpPolicyTemplateMetaData.PolicyCommands &#x3D; (from policyCommand in root.Element(&quot;policyCommands&quot;).Elements(&quot;commandBlock&quot;)</span><br><span class="line">        select policyCommand.Value.Trim()).ToList&lt;string&gt;();</span><br><span class="line">        dlpPolicyTemplateMetaData.LocalizedPolicyCommandResources &#x3D; (from localizedResource in root.Element(&quot;policyCommandsResources&quot;).Elements(&quot;resource&quot;)</span><br><span class="line">        select new KeyValuePair&lt;string, Dictionary&lt;string, string&gt;&gt;(localizedResource.Attribute(&quot;token&quot;).Value.Trim(), DlpPolicyParser.ParseLocalizedString(localizedResource))).ToDictionary((KeyValuePair&lt;string, Dictionary&lt;string, string&gt;&gt; pair) &#x3D;&gt; pair.Key, (KeyValuePair&lt;string, Dictionary&lt;string, string&gt;&gt; pair) &#x3D;&gt; pair.Value, StringComparer.OrdinalIgnoreCase);</span><br><span class="line">        &#x2F;&#x2F;对数据进行验证，跟进该函数内部</span><br><span class="line">        dlpPolicyTemplateMetaData.Validate();</span><br><span class="line">        result &#x3D; dlpPolicyTemplateMetaData;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (ArgumentException innerException)</span><br><span class="line">    &#123;</span><br><span class="line">        throw new DlpPolicyParsingException(Strings.DlpPolicyStateStateInvalid, innerException);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (NullReferenceException innerException2)</span><br><span class="line">    &#123;</span><br><span class="line">        throw new DlpPolicyParsingException(Strings.DlpPolicyXmlMissingElements, innerException2);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (XmlException innerException3)</span><br><span class="line">    &#123;</span><br><span class="line">        throw new DlpPolicyParsingException(Strings.DlpPolicyXmlInvalid, innerException3);</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>从上面代码中，我们可以看到，每条数据都保存到了<code>dlpPolicyTemplateMetaData</code>变量中，接着又调用了<code>dlpPolicyTemplateMetaData.Validate()</code>对数据进行验证。</p>
<p><img src="/img/cve-2020-16875/4.png" alt="4"></p>
<p>跟进<code>Microsoft.Exchange.MessagingPolicies.CompliancePrograms.Tasks.DlpPolicyTemplateMetaData.Validate()</code>函数，我们可以看到对每条数据都进行了验证，但是从函数名来看，似乎只是验证数据长度是否符合要求</p>
<p><img src="/img/cve-2020-16875/5.png" alt="5"></p>
<p>查看<code>ValidateFieldSize</code>函数的定义，可以确定只是简单的限制了长度，并没有做其他的过滤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">internal static void ValidateFieldSize(string fieldName, string value, int sizeLimit)</span><br><span class="line">    &#123;</span><br><span class="line">        if (value.Length &gt; sizeLimit)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new DlpPolicyParsingException(Strings.DlpPolicyFieldLengthsExceedsLimit(fieldName, sizeLimit));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这时候我们可以看到，传入的<code>payload</code>被完整的保存了下来</p>
<p><img src="/img/cve-2020-16875/6.png" alt="6"></p>
<p>接下来还要进一步的对<code>cmdlet</code>参数进行验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DlpPolicyTemplateMetaData.ValidateCmdletParameters(x, DlpPolicyTemplateMetaData.RequiredCmdletParameters)</span><br></pre></td></tr></table></figure>
<p>查看该函数定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">internal static void ValidateCmdletParameters(string cmdlet, IEnumerable&lt;KeyValuePair&lt;string, string&gt;&gt; requiredParameters)</span><br><span class="line">&#123;</span><br><span class="line">    foreach (KeyValuePair&lt;string, string&gt; keyValuePair in requiredParameters)</span><br><span class="line">    &#123;</span><br><span class="line">        if (cmdlet.StartsWith(keyValuePair.Key, StringComparison.InvariantCultureIgnoreCase) &amp;&amp; !Regex.IsMatch(cmdlet, keyValuePair.Value, RegexOptions.IgnoreCase))</span><br><span class="line">        &#123;</span><br><span class="line">            throw new DlpPolicyParsingException(Strings.DlpPolicyMissingRequiredParameter(cmdlet, keyValuePair.Value));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>requiredParameters</code>的键值为：<code>[&quot;New-TransportRule&quot;, &quot;-DlpPolicy&quot;]</code>。首先判断了<code>cmdlet</code>的开头是否为传入的<code>New-TransportRule</code>，接着再判断是否匹配<code>-DlpPolicy</code>的值，如果开头匹配并且内容不匹配，则直接抛出异常解析错误。我们跟入查看此时的值是什么：</p>
<p><img src="/img/cve-2020-16875/15.png" alt="15"></p>
<p>从上面可以看到，在判断<code>StartsWith</code>的时候，返回的结果就是<code>False</code>了，所以程序可以正常执行，不会抛出异常。</p>
<p>接着继续一步一步调试，跟踪到<code>&#123;Microsoft.Exchange.MessagingPolicies.CompliancePrograms.Tasks.NewDlpPolicyImpl&#125;.Validate()</code>函数，这里判断数据是否被修改过，如果修改了，则使用新的数据。在这里可以看到，传入的<code>TemplateData</code>被成功传入了<code>CmdletInfo</code>中，作为命令的参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dlpPolicyTemplateMetaData &#x3D; this.LoadDlpPolicyFromCustomTemplateData();</span><br></pre></td></tr></table></figure>

<p><img src="/img/cve-2020-16875/7.png" alt="7"></p>
<p>最后调用<code>DlpUtils.CheckForUnifiedComplianceAvailability&lt;ADComplianceProgram&gt;(this.taskObject, SystemConfigurationTasksHelper.GetCmdletName(this.taskObject.GetType()))</code>进行进一步处理。</p>
<p>单步跟进，函数到了<code>Microsoft.Exchange.Configuration.Tasks.Task.ProcessRecord()</code>对<code>&#123;Microsoft.Exchange.MessagingPolicies.CompliancePrograms.Tasks.NewDlpPolicy&#125;</code>进行处理。</p>
<p>这时候进入到<code>this.ProcessTaskStage</code>的<code>MainFunc</code>中，这时候我们查看局部变量的数据，可以看到我们的数据都已经传入了。<br><code>ProcessTaskStage</code>定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private void ProcessTaskStage(TaskStage taskStage, Action initFunc, Action mainFunc, Action completeFunc)</span><br></pre></td></tr></table></figure>

<p><img src="/img/cve-2020-16875/9.png" alt="9"></p>
<p><code>MainFunc</code>函数定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">delegate</span><br><span class="line">&#123;</span><br><span class="line">    using (new CmdletMonitoredScope(this.CurrentTaskContext.UniqueId, &quot;BizLogic&quot;, &quot;Task.ProcessRecord&#x2F;InnerProcessRecord&quot;, LoggerHelper.CmdletPerfMonitors))</span><br><span class="line">    &#123;</span><br><span class="line">        using (new CmdletMonitoredScope(this.CurrentTaskContext.UniqueId, &quot;BizLogic&quot;, &quot;InnerProcessRecord&#x2F;InternalStateReset&quot;, LoggerHelper.CmdletPerfMonitors))</span><br><span class="line">        &#123;</span><br><span class="line">            this.InternalStateReset();</span><br><span class="line">        &#125;</span><br><span class="line">        if (!this.HasErrors)</span><br><span class="line">        &#123;</span><br><span class="line">            this.PreInternalValidate();</span><br><span class="line">            using (new CmdletMonitoredScope(this.CurrentTaskContext.UniqueId, &quot;BizLogic&quot;, &quot;InnerProcessRecord&#x2F;InternalValidate&quot;, LoggerHelper.CmdletPerfMonitors))</span><br><span class="line">            &#x2F;&#x2F;函数首先会进入到这里进行一个内部验证，如果验证通过则会进行下一步，但是实际上如果程序未超时，格式正确，这里什么都没有做</span><br><span class="line">            &#123;</span><br><span class="line">                this.InternalValidate();</span><br><span class="line">            &#125;</span><br><span class="line">            this.PostInternalValidate();</span><br><span class="line">        &#125;</span><br><span class="line">        if (!this.HasErrors)</span><br><span class="line">        &#123;</span><br><span class="line">            ProvisioningValidationError[] array &#x3D; ProvisioningLayer.ValidateUserScope(this);</span><br><span class="line">            if (array !&#x3D; null &amp;&amp; array.Length !&#x3D; 0)</span><br><span class="line">            &#123;</span><br><span class="line">                for (int i &#x3D; 0; i &lt; array.Length; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    ProvisioningValidationException exception &#x3D; new ProvisioningValidationException(array[i].Description, array[i].AgentName, array[i].Exception);</span><br><span class="line">                    this.WriteError(exception, (ErrorCategory)array[i].ErrorCategory, null, array.Length - 1 &#x3D;&#x3D; i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            this.InternalProvisioningValidation();</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;在创建新的dlp策略时候，这里会调用新的cmdinfo对象&#123;Get-Notification&#125;来发出确认信息</span><br><span class="line"></span><br><span class="line">        if (!this.HasErrors)</span><br><span class="line">        &#123;</span><br><span class="line">            LocalizedString confirmationMessage &#x3D; this.ConfirmationMessage;</span><br><span class="line">            if (confirmationMessage &#x3D;&#x3D; LocalizedString.Empty || this.ShouldProcess(confirmationMessage))</span><br><span class="line">            &#123;</span><br><span class="line">                string orgId &#x3D; (this.CurrentOrganizationId !&#x3D; null) ? this.CurrentOrganizationId.ToString() : string.Empty;</span><br><span class="line">                if (this.IsVerboseOn &amp;&amp; !TaskLogger.IsSetupLogging)</span><br><span class="line">                &#123;</span><br><span class="line">                    this.WriteVerbose(Strings.VerboseResolvedOrganization(orgId));</span><br><span class="line">                &#125;</span><br><span class="line">                this.PreInternalProcessRecord();</span><br><span class="line">                using (new CmdletMonitoredScope(this.CurrentTaskContext.UniqueId, &quot;BizLogic&quot;, &quot;InnerProcessRecord&#x2F;InternalProcessRecord&quot;, LoggerHelper.CmdletPerfMonitors))</span><br><span class="line">                &#123;</span><br><span class="line">                    &#x2F;&#x2F;前面验证过后，最后会到这里来</span><br><span class="line">                    this.InternalProcessRecord();</span><br><span class="line">                    goto IL_1C8;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            this.CurrentTaskContext.WasCancelled &#x3D; true;</span><br><span class="line">            CmdletLogger.SafeSetLogger(this.CurrentTaskContext.UniqueId, RpsCmdletMetadata.ExecutionResult, &quot;Cancelled&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        IL_1C8:</span><br><span class="line">        ProvisioningLayer.OnComplete(this, !this.CurrentTaskContext.WasCancelled &amp;&amp; !this.HasErrors, null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序接着会进入到<code>InternalProcessRecord()</code>，实际上是进入了<code>Microsoft.Exchange.MessagingPolicies.CompliancePrograms.Tasks.NewDlpPolicy.InternalProcessRecord()</code></p>
<p><img src="/img/cve-2020-16875/11.png" alt="11"></p>
<p>在该函数运行后，会进入到<code>&#123;Microsoft.Exchange.MessagingPolicies.CompliancePrograms.Tasks.DlpUtils&#125;.AddTenantDlpPolicy()</code>函数，在这里会造成RCE，函数定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public static void AddTenantDlpPolicy(IConfigDataProvider dataSession, DlpPolicyMetaData dlpPolicy, string organizationParameterValue, out IEnumerable&lt;PSObject&gt; results, bool skipTransportRules &#x3D; false)</span><br><span class="line">&#123;</span><br><span class="line">    results &#x3D; null;</span><br><span class="line">    ADComplianceProgram adcomplianceProgram &#x3D; dlpPolicy.ToAdObject();</span><br><span class="line">    ADComplianceProgramCollection dlpPolicyCollection &#x3D; DlpUtils.GetDlpPolicyCollection(dataSession, DlpUtils.TenantDlpPoliciesCollectionName);</span><br><span class="line">    adcomplianceProgram.OrganizationId &#x3D; dlpPolicyCollection.OrganizationId;</span><br><span class="line">    adcomplianceProgram.SetId(dlpPolicyCollection.Id.GetChildId(dlpPolicy.Name));</span><br><span class="line">    dataSession.Save(adcomplianceProgram, &quot;d:\\dbs\\sh\\e16df\\1128_112205\\cmd\\e\\sources\\dev\\management\\SRC\\Management\\SystemConfigurationTasks\\DlpPolicy\\Utils.cs&quot;, 272, &quot;AddTenantDlpPolicy&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; skipTransportRules必须为false，否则无法触发漏洞</span><br><span class="line">    if (skipTransportRules)</span><br><span class="line">    &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;关键点1</span><br><span class="line">    IEnumerable&lt;string&gt; cmdlets &#x3D; Utils.AddOrganizationScopeToCmdlets(dlpPolicy.PolicyCommands, organizationParameterValue);</span><br><span class="line">    string domainController &#x3D; null;</span><br><span class="line">    ADSessionSettings sessionSettings &#x3D; null;</span><br><span class="line">    MessagingPoliciesSyncLogDataSession messagingPoliciesSyncLogDataSession &#x3D; dataSession as MessagingPoliciesSyncLogDataSession;</span><br><span class="line">    if (messagingPoliciesSyncLogDataSession !&#x3D; null)</span><br><span class="line">    &#123;</span><br><span class="line">        domainController &#x3D; messagingPoliciesSyncLogDataSession.LastUsedDc;</span><br><span class="line">        sessionSettings &#x3D; messagingPoliciesSyncLogDataSession.SessionSettings;</span><br><span class="line">    &#125;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">        results &#x3D; CmdletRunner.RunCmdlets(cmdlets, false);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (ParseException e)</span><br><span class="line">    &#123;</span><br><span class="line">        DlpUtils.HandleScriptExecutionError(adcomplianceProgram, DlpUtils.GetErrorHandlingDataSession(domainController, sessionSettings, dataSession), e);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (RuntimeException e2)</span><br><span class="line">    &#123;</span><br><span class="line">        DlpUtils.HandleScriptExecutionError(adcomplianceProgram, DlpUtils.GetErrorHandlingDataSession(domainController, sessionSettings, dataSession), e2);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (CmdletExecutionException e3)</span><br><span class="line">    &#123;</span><br><span class="line">        DlpUtils.HandleScriptExecutionError(adcomplianceProgram, DlpUtils.GetErrorHandlingDataSession(domainController, sessionSettings, dataSession), e3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从函数中，可以看到，程序直接读取了<code>dlpPolicy.PolicyCommands</code>，赋值给了<code>cmdlets</code>，</p>
<p><img src="/img/cve-2020-16875/12.png" alt="12"></p>
<p>而<code>cmdlets</code>最后则传给了<code>CmdletRunner.RunCmdlets</code>函数，作为<code>powershell</code>运行起来了，从而造成了RCE</p>
<p><img src="/img/cve-2020-16875/13.png" alt="13"></p>
<p>进入该函数，可以看到对命令进行了调用</p>
<p><img src="/img/cve-2020-16875/14.png" alt="14"></p>
<p>造成这个漏洞形成，主要是因为没有对<code>TemplateData</code>进行过滤，而<code>DlpUtils.AddTenantDlpPolicy()</code>函数会对模板文件中的<code>CommandBlock</code>进行执行，从而导致RCE</p>
<h3 id="更新补丁"><a href="#更新补丁" class="headerlink" title="更新补丁"></a>更新补丁</h3><p>补丁代码对<code>CommandBlock</code>块的数据进行了多重的验证，首先判断了是否只是包含单个命令，其次再判断传入的<code>cmdlet</code>是否以<code>New-TransportRule</code>开头，接着再判断<code>cmdlet</code>的内容是否有匹配到<code>-DlpPolicy</code>，只要有其中一个不正确，则抛出异常。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">internal static void ValidateCmdletParameters(string cmdlet, IEnumerable&lt;KeyValuePair&lt;string, string&gt;&gt; requiredParameters)</span><br><span class="line">&#123;</span><br><span class="line">    if (string.IsNullOrWhiteSpace(cmdlet))</span><br><span class="line">    &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    Collection&lt;PSParseError&gt; collection2;</span><br><span class="line">    Collection&lt;PSToken&gt; collection &#x3D; PSParser.Tokenize(cmdlet, out collection2);</span><br><span class="line">    if (collection2 !&#x3D; null &amp;&amp; collection2.Count &gt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        throw new DlpPolicyParsingException(Strings.DlpPolicyNotSupportedCmdlet(cmdlet));</span><br><span class="line">    &#125;</span><br><span class="line">    if (collection !&#x3D; null)</span><br><span class="line">    &#123;</span><br><span class="line">        if ((from token in collection</span><br><span class="line">        where token.Type &#x3D;&#x3D; PSTokenType.Command</span><br><span class="line">        select token).ToList&lt;PSToken&gt;().Count &gt; 1)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new DlpPolicyParsingException(Strings.DlpPolicyMultipleCommandsNotSupported(cmdlet));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    bool flag &#x3D; false;</span><br><span class="line">    foreach (KeyValuePair&lt;string, string&gt; keyValuePair in requiredParameters)</span><br><span class="line">    &#123;</span><br><span class="line">        if (cmdlet.StartsWith(keyValuePair.Key, StringComparison.InvariantCultureIgnoreCase))</span><br><span class="line">        &#123;</span><br><span class="line">            if (!Regex.IsMatch(cmdlet, keyValuePair.Value, RegexOptions.IgnoreCase))</span><br><span class="line">            &#123;</span><br><span class="line">                throw new DlpPolicyParsingException(Strings.DlpPolicyMissingRequiredParameter(cmdlet, keyValuePair.Value));</span><br><span class="line">            &#125;</span><br><span class="line">            flag &#x3D; true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!flag)</span><br><span class="line">    &#123;</span><br><span class="line">        throw new DlpPolicyParsingException(Strings.DlpPolicyNotSupportedCmdlet(cmdlet));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a target="_blank" rel="noopener" href="https://srcincite.io/advisories/src-2020-0019/">https://srcincite.io/advisories/src-2020-0019/</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/POC/">POC</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%88%90%E5%9B%A0"><span class="toc-number">1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A1%A5%E4%B8%81"><span class="toc-number">3.</span> <span class="toc-text">更新补丁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="toc-number">4.</span> <span class="toc-text">参考文档</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/11/19/CVE-2020-16875/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&text=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&title=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&is_video=false&description=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2020-16875 Exchange Server RCE&body=Check out this article: http://yoursite.com/2020/11/19/CVE-2020-16875/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&title=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&title=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&title=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&title=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/11/19/CVE-2020-16875/&name=CVE-2020-16875 Exchange Server RCE&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2020/11/19/CVE-2020-16875/&t=CVE-2020-16875 Exchange Server RCE"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2021
    lex
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/POC/">POC</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
